# Exploratory data analysis

```{r, echo = FALSE, message = FALSE}
source(here::here("scripts/setup.R"))
```

## Essai
```{r}

ggplot(dnb_results)+
  geom_bar(mapping = aes(x = registered, fill = department))
```

Number of admitted by region 
```{r}

dnb_results %>% 
 select(admitted, region) %>% 
 group_by(region) %>% 
 summarise(sum = sum(admitted)) %>% 
 ggplot(aes(x = region, y = sum, fill = region)) + 
 geom_col() +
 theme(axis.title.x=element_blank(),
       axis.text.x=element_blank(),
       axis.ticks.x=element_blank()
       )
```

Average success rate by department
```{r}

dnb_results %>% 
  select(success_rate_pct, region) %>% 
  group_by(department) %>% 
  summarise(mean = mean(success_rate_pct)) %>% 
  ggplot(aes(x = department, y = mean, fill = region)) + 
  geom_col() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()
        )

```


regression Essai 

```{r}


```




## esssai carte 

Creation of the map theme
```{r}

map_theme <- theme(title=element_text(),
                   plot.title=element_text(margin=margin(20,20,20,20), size=18, hjust = 0.5),
                   axis.text.x=element_blank(),
                   axis.text.y=element_blank(),
                   axis.ticks=element_blank(),
                   axis.title.x=element_blank(),
                   axis.title.y=element_blank(),
                   panel.grid.major= element_blank(), 
                   panel.background= element_blank()) 
```

Creation of the dataset used for the map
```{r}

result <- dnb_results %>% 
  select(department_fr, success_rate_pct) %>% 
  group_by(department_fr) %>% 
  summarise(mean = mean(success_rate_pct))

```
Join the map from ggplot and our new dataset
```{r}

result_map <- left_join(x = map[,-6], y = result)
```

plot
```{r}

ggplot(result_map, aes(long,lat, group = group, fill = mean)) +
  geom_polygon() +
  coord_map() +
  scale_fill_gradient(name = "Average sucess  rate") +
  labs(x = "", 
       y = "", 
       title = "Average success rate, xxxx-2021") +
  map_theme  
#for other examples to change colours https://colinfay.me/mapping-the-french-second-round-results-with-r/
```


* Mapping out the underlying structure
* Identifying the most important variables
* Univariate visualizations
* Multivariate visualizations
* Summary tables