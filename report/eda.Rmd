# Exploratory data analysis

```{r, echo = FALSE, message = FALSE}
source(here::here("scripts/setup.R"))
```

## Essai
We are mostly exploring our options and have yet to truly deep dive into this portion of our project. 

### Box plot Analysis
```{r}
dnb_pct_dep <- dnb_results %>%
  group_by(department, session) %>% 
  summarise(AB_pct_dep = mean(AB_pct, na.rm = TRUE),
            B_pct_dep = mean(B_pct, na.rm = TRUE),
            TB_pct_dep = mean(TB_pct, na.rm = TRUE),
            without_pct_dep = mean(without_pct, na.rm = TRUE),
            success_rate_pct_dep = mean(success_rate_pct, na.rm = TRUE))
```



```{r}

dnb_pct_dep %>% 
  ggplot(aes(x = session, y = AB_pct_dep, group = session, fill = session)) +
        geom_boxplot()+
        geom_jitter(width = 0.25, alpha = 0.5)+ 
        scale_fill_gradientn(colors = viridis(16))+
        guides(fill = "none")
 # ggplotly(tooltip = c("department", "AB_pct_dep")) does not show department


```




```{r, echo = TRUE}

ggplot(dnb_results)+
  geom_bar(mapping = aes(x = registered, fill = department))
```

Number of admitted by region 
```{r, echo = TRUE}

dnb_results %>% 
 select(admitted, region) %>% 
 group_by(region) %>% 
 summarise(sum = sum(admitted)) %>% 
 ggplot(aes(x = region, y = sum, fill = region)) + 
 geom_col() +
 theme(axis.title.x=element_blank(),
       axis.text.x=element_blank(),
       axis.ticks.x=element_blank()
       )
```

Average TB percentage by region 
```{r, echo = TRUE}

dnb_results %>% 
 select(TB_pct, region) %>% 
 group_by(region) %>% 
 summarise(mean = mean(TB_pct, na.rm = TRUE)) %>% 
 ggplot(aes(x = region, y = mean, fill = region)) + 
 geom_col() +
 theme(axis.title.x=element_blank(),
       axis.text.x=element_blank(),
       axis.ticks.x=element_blank()
       )
```

Average AB percentage by region 
```{r, echo = TRUE}

dnb_results %>% 
 select(AB_pct, region) %>% 
 group_by(region) %>% 
 summarise(mean = mean(AB_pct, na.rm = TRUE)) %>% 
 ggplot(aes(x = region, y = mean, fill = region)) + 
 geom_col() +
 theme(axis.title.x=element_blank(),
       axis.text.x=element_blank(),
       axis.ticks.x=element_blank()
       )
```

Average B percentage by region 
```{r, echo = TRUE}

dnb_results %>% 
 select(B_pct, region) %>% 
 group_by(region) %>% 
 summarise(mean = mean(B_pct, na.rm = TRUE)) %>% 
 ggplot(aes(x = region, y = mean, fill = region)) + 
 geom_col() +
 theme(axis.title.x=element_blank(),
       axis.text.x=element_blank(),
       axis.ticks.x=element_blank()
       )
```

Average percentage of admitted without mention students by region 
```{r, echo = TRUE}

dnb_results %>% 
 select(without_pct, region) %>% 
 group_by(region) %>% 
 summarise(mean = mean(without_pct, na.rm = TRUE)) %>% 
 ggplot(aes(x = region, y = mean, fill = region)) + 
 geom_col() +
 theme(axis.title.x=element_blank(),
       axis.text.x=element_blank(),
       axis.ticks.x=element_blank()
       )
```

Average success rate by department
```{r, echo = TRUE}

dnb_results %>% 
  select(success_rate_pct, region, department) %>% 
  group_by(department) %>% 
  summarise(mean = mean(success_rate_pct, na.rm = TRUE)) %>% 
  ggplot(aes(x = department, y = mean, fill = department)) + 
  geom_col() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()
        )

```


regression Essai 

```{r, echo = TRUE}
lm1 <- lm(dnb_results$TB_pct ~ dnb_results$without_pct + dnb_results$B_pct + dnb_results$AB_pct + dnb_results$without_pct)
summary(lm1)
```


cluster Essai 

```{r, echo = TRUE}
dnb_pct_dep <- dnb_results %>%
  group_by(department, session) %>% 
  summarise(AB_pct_dep = mean(AB_pct, na.rm = TRUE),
            B_pct_dep = mean(B_pct, na.rm = TRUE),
            TB_pct_dep = mean(TB_pct, na.rm = TRUE),
            without_pct_dep = mean(without_pct, na.rm = TRUE),
            success_rate_pct_dep = mean(success_rate_pct, na.rm = TRUE))

pairs(dnb_pct_dep[2:6])

distance <- dist(dnb_pct_dep)

mydata.hclust <- hclust(distance)
plot(mydata.hclust)

```


## esssai carte 

Creation of the map theme
```{r, echo = TRUE}

map_theme <- theme(title=element_text(),
                   plot.title=element_text(margin=margin(20,20,20,20), size=18, hjust = 0.5),
                   axis.text.x=element_blank(),
                   axis.text.y=element_blank(),
                   axis.ticks=element_blank(),
                   axis.title.x=element_blank(),
                   axis.title.y=element_blank(),
                   panel.grid.major= element_blank(), 
                   panel.background= element_blank()) 
```

Creation of the dataset used for the map
```{r, echo = TRUE}

result <- dnb_results %>% 
  select(department_fr, success_rate_pct) %>% 
  group_by(department_fr) %>% 
  summarise(mean = mean(success_rate_pct))

```
Join the map from ggplot and our new dataset
```{r, echo = TRUE}

result_map <- left_join(x = map[,-6], y = result)
```

plot
```{r, echo = TRUE}

ggplot(result_map, aes(long,lat, group = group, fill = mean)) +
  geom_polygon() +
  coord_map() +
  scale_fill_gradient(name = "Average sucess  rate") +
  labs(x = "", 
       y = "", 
       title = "Average success rate, xxxx-2021") +
  map_theme  
#for other examples to change colours https://colinfay.me/mapping-the-french-second-round-results-with-r/
```


* Mapping out the underlying structure
* Identifying the most important variables
* Univariate visualizations
* Multivariate visualizations
* Summary tables